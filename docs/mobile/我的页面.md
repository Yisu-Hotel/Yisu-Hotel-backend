# Yisu Hotel 移动端“我的”页面前端流程文档

本文档详细描述了移动端“我的”页面（用户中心）相关的所有业务逻辑流程、页面交互以及接口对接细节。

---

## 0. 暂不实现的功能说明 (Out of Scope)

以下功能在当前版本中由于数据库结构或业务优先级原因暂不实现：

- **浏览历史**: 由于尚未构建相关的数据库表，该功能暂时不做。
- **客服中心**: 暂时不做。
- **帮助中心**: 暂时不做。

---

## 1. 用户认证流程 (Auth Flow)

用户认证是整个应用的基础，涉及“我的”页面入口、注册、登录及找回密码。

### 1.1 入口：我的页面
- **页面描述**: 用户中心主页。
- **操作**: 点击页面最上方区域（头像/“登录/注册”文字）。

### 1.2 注册流程
1. **输入手机号**: 用户在注册标签页输入手机号。
2. **获取验证码**:
   - 点击“获取验证码”按钮。
   - **接口调用**: 调用 [Auth_API: 2.1 发送验证码](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/Auth_API.md#L24)。
   - **参数**: `{ "phone": "...", "type": "register" }`。
3. **填写注册信息**: 用户收到短信后，填入 6 位验证码，并设置登录密码。
4. **同意协议**: 勾选“我已阅读并同意用户协议及隐私政策”。
5. **提交注册**:
   - 点击“立即注册”。
   - **接口调用**: 调用 [Auth_API: 2.2 用户注册](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/Auth_API.md#L86)。
   - **参数**: `{ "phone": "...", "code": "...", "password": "...", "agreed": true }`。
6. **注册成功**:
   - 后端返回 `token` 及用户信息。
   - **存储**: 前端将 `token` 保存至 `localStorage`。

### 1.3 登录流程
1. **输入信息**: 用户输入已注册的手机号和密码。
2. **选择保持登录**: 勾选“30天内自动登录”。
3. **提交登录**:
   - **接口调用**: 调用 [Auth_API: 2.3 用户登录](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/Auth_API.md#L166)。
   - **动态参数**: 
     - 若勾选了“30天内自动登录”，请求体需包含 `"token_expires_in": 2592000` (即 30*24*3600 秒)。
4. **登录成功**:
   - **存储**: 将返回的 `token` 持久化存储在 `localStorage`。

### 1.4 重置密码流程
1. **找回密码入口**: 在登录页面点击“忘记密码”。
2. **跳转**: 进入 **重置密码页面**。
3. **身份验证**:
   - 输入手机号，点击获取验证码。
   - **接口调用**: 调用 [Auth_API: 2.1 发送验证码](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/Auth_API.md#L24)，`type` 传 `reset`。
4. **设置新密码**: 输入收到的验证码及新密码。
5. **提交重置**:
   - **接口调用**: 调用 [Auth_API: 2.4 重置密码](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/Auth_API.md#L238)。
   - **参数**: `{ "phone": "...", "code": "...", "password": "..." }`。
6. **重置成功**:
   - **跳转**: 页面自动跳转至 **登录页面**，引导用户使用新密码重新登录。

---

## 2. 订单管理流程 (Booking Flow)

订单管理模块主要位于“我的”页面下的”我的订单“，通过状态分类展示用户的历史预订记录。

### 2.1 订单分类入口
- **页面位置**: “我的”页面中部的“我的订单”标签页。
- **UI 更新**: 将原有的“待支付”、“待确认”、“待入住”、“已完成”统一调整为以下 5 个分类入口：
    1. **待付款**
    2. **已付款**
    3. **已完成**
    4. **已取消**
    5. **全部订单**

### 2.2 订单列表查询逻辑
- **操作**: 用户点击上述任意分类入口。
- **跳转**: 进入 **订单列表页面**，并默认选中对应的标签页。
- **接口交互**:
    - **接口调用**: 调用 [Booking_API: 2.1 查询订单列表](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/Booking_API.md#L25)。
    - **参数映射**:
        - **待付款**: 传入 `status=pending`。
        - **已付款**: 传入 `status=paid`。
        - **已完成**: 传入 `status=completed`。
        - **已取消**: 传入 `status=cancelled`。
        - **全部订单**: 不传 `status` 参数（或传空字符串）。
- **分页处理**: 列表支持瀑布流滚动加载，通过 `page` 和 `pageSize` 参数进行分页查询。

### 2.3 订单状态展示
- 前端应根据接口返回的 `status` 字段在卡片上展示对应的状态标签：
    - `pending` -> 展示为“待付款”，并显示“去支付”按钮。
    - `paid` -> 展示为“已付款”。
    - `completed` -> 展示为“已完成”。
    - `cancelled` -> 展示为“已取消”。

### 2.4 查看订单详情
- **操作**: 在订单列表页点击任意订单卡片。
- **跳转**: 进入 **订单详情页面**，并传递 `order_id` 参数。
- **接口调用**: 调用 [Booking_API: 2.2 查询订单详情](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/Booking_API.md#L110)。
- **数据展示**: 展示订单状态、酒店信息、房型信息、入住人信息、价格明细及订单号等。
- **酒店详情跳转**: 
    - **操作**: 点击详情页中的酒店名称。
    - **逻辑**: 获取 `hotel_id` 并自动跳转至 **酒店详情页面**。

---

## 3. 收藏管理流程 (Favorite Flow)

用户可以通过“我的”页面进入收藏列表，管理感兴趣的酒店。

### 3.1 进入收藏列表
- **操作**: 点击“我的”页面中的“我的收藏”。
- **跳转**: 进入 **我的收藏页面**。
- **接口调用**: 调用 [Favorite_API: 2.3 获取收藏列表](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/Favorite_API.md#L139)。
- **数据展示**:
    - 页面展示收藏酒店的列表，每个酒店卡片包含：酒店名称（中/英）、星级、评分、主图、标签、城市信息及当前最低价。
    - 参考数据结构：[Favorite_API 响应示例](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/Favorite_API.md#L164-198)。

### 3.2 取消收藏操作
- **UI 交互**: 每个酒店卡片右侧设有一个“已收藏”状态的按钮。
- **操作**: 点击该按钮。
- **接口调用**: 调用 [Favorite_API: 2.2 取消收藏](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/Favorite_API.md#L86)。
- **参数**: `{ "hotel_id": "..." }`。
- **反馈**: 成功后，该酒店卡片从列表中移除，或按钮状态变更为“未收藏”。

### 3.3 进入酒店详情
- **操作**: 点击酒店卡片的任意非按钮区域。
- **跳转**: 跳转至 **酒店详情页面**，并传递 `hotel_id` 参数。

---

## 4. 优惠券管理流程 (Coupon Flow)

用户可以在“我的”页面查看并管理已领取的优惠券。

### 4.1 优惠券列表查询
- **操作**: 点击“我的”页面中的“查看优惠券”。
- **跳转**: 进入 **优惠券列表页面**。
- **状态筛选**: 页面顶部设有筛选栏（可用、已使用、已过期）。
- **接口调用**: 调用 [Coupon_API: 2.1 获取优惠券列表](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/Coupon_API.md#L24)。
- **参数映射**:
    - **可用**: `status=available`。
    - **已使用**: `status=used`。
    - **已过期**: `status=expired`。

### 4.2 查看优惠券详情
- **操作**: 点击列表中的单张优惠券。
- **跳转**: 进入 **优惠券详情弹窗/页面**。
- **接口调用**: 调用 [Coupon_API: 2.2 获取优惠券详情](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/Coupon_API.md#L104)。
- **数据展示逻辑**:
    - **通用信息**: 展示标题、描述、优惠值、门槛、有效期及规则。
    - **关联订单 (booking_info)**:
        - 若 `status` 为 `used`：展示关联的订单信息（订单号、酒店名、入住/离店日期、总价等）。参考：[Coupon_API 详情响应](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/Coupon_API.md#L145-155)。
        - 其他状态：不展示 `booking_info` 区域。

---

## 5. 个人信息设置流程 (User Profile Settings Flow)

用户可以通过“我的”页面进入设置，查看并修改个人资料。

### 5.1 进入设置页面
- **操作**: 点击“我的”页面中的“设置”按钮（通常位于右上角或个人信息区域旁）。
- **接口调用**: 调用 [User_API: 2.1 获取个人信息](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/User_API.md#L22)。
- **数据展示**: 页面展示用户的手机号 (`phone`)、昵称 (`nickname`)、性别 (`gender`)、生日 (`birthday`) 及头像 (`avatar`)。

### 5.2 编辑个人信息
- **编辑交互**: 点击“修改”按钮进入编辑模式，或直接点击各信息项进行修改。
- **可编辑字段**:
    - **头像**: 点击头像区域触发图片选择。
    - **昵称**: 文本输入。
    - **性别**: 选择器（男/女/保密）。
    - **生日**: 日期选择器。
    - **手机号**: 展示当前绑定手机号（注：[User_API 2.2](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/User_API.md#L80) 暂不支持通过此接口修改手机号）。

### 5.3 图片处理逻辑
- **逻辑**: 若用户更换了头像图片，前端需在保存前将选中的图片文件转换为 **Base64** 字符串格式。

### 5.4 保存更新
- **操作**: 点击“保存”按钮。
- **接口调用**: 调用 [User_API: 2.2 更新个人信息](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/User_API.md#L80)。
- **请求体**: 包含 `nickname`, `gender`, `birthday` 以及 `avatar_base64`（如有新头像）。
- **反馈**: 保存成功后提示用户，并自动返回上一页。

### 5.5 返回刷新逻辑
- **逻辑**: 用户从设置页面返回“我的”页面时，前端应再次触发 [User_API: 2.1 获取个人信息](file:///d:/Yisu/Yisu-Hotel-backend/docs/mobile/User_API.md#L22) 接口。
- **目的**: 实时更新“我的”页面顶部的昵称和头像展示，确保数据一致性。
